<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Admin Dashboard - VanMitra</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 50%, #6ab04c 100%);
            min-height: 100vh;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2d5016;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid #6ab04c;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .applications-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #2d5016, #4a7c59);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-filters {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .applications-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .application-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s ease;
            cursor: pointer;
        }

        .application-item:hover {
            background: #f8f9fa;
        }

        .app-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .app-id {
            font-weight: bold;
            color: #2d5016;
            font-size: 1.1em;
        }

        .app-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-submitted { background: #e3f2fd; color: #1976d2; }
        .status-under-review { background: #fff3e0; color: #f57c00; }
        .status-approved { background: #e8f5e9; color: #388e3c; }
        .status-rejected { background: #ffebee; color: #d32f2f; }

        .app-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: #6ab04c;
            color: white;
        }

        .btn-warning {
            background: #f57c00;
            color: white;
        }

        .btn-success {
            background: #388e3c;
            color: white;
        }

        .btn-danger {
            background: #d32f2f;
            color: white;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .quick-actions {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .quick-actions h3 {
            color: #2d5016;
            margin-bottom: 20px;
        }

        .quick-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #6ab04c, #4a7c59);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .quick-btn:hover {
            transform: translateY(-2px);
        }

        .recent-activity {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .activity-item {
            padding: 15px;
            border-left: 3px solid #6ab04c;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }

        .activity-time {
            font-size: 0.8em;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .search-filters {
                flex-direction: column;
            }
            
            .app-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üèõÔ∏è Registration Admin Dashboard</h1>
            <p>Manage Forest Rights Act land claim applications</p>
        </div>

        <div class="stats-grid" id="statsGrid">
            <!-- Statistics will be loaded here -->
        </div>

        <div class="main-content">
            <div class="applications-section">
                <div class="section-header">
                    <h2>üìã Applications Management</h2>
                    <button onclick="refreshData()" class="btn btn-primary">üîÑ Refresh</button>
                </div>

                <div class="search-filters">
                    <input type="text" id="searchInput" class="filter-input" placeholder="Search by Application ID or Name">
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="submitted">Submitted</option>
                        <option value="under_review">Under Review</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <input type="date" id="dateFilter" class="filter-input">
                    <button onclick="applyFilters()" class="btn btn-primary">Filter</button>
                </div>

                <div class="applications-list" id="applicationsList">
                    <!-- Applications will be loaded here -->
                </div>
            </div>

            <div class="sidebar">
                <div class="quick-actions">
                    <h3>‚ö° Quick Actions</h3>
                    <a href="land_claim_registration.html" class="quick-btn">‚ûï New Registration</a>
                    <a href="status_check.html" class="quick-btn">üîç Check Status</a>
                    <button onclick="exportData()" class="quick-btn">üìä Export Data</button>
                    <button onclick="generateReport()" class="quick-btn">üìÑ Generate Report</button>
                </div>

                <div class="recent-activity">
                    <h3>üìà Recent Activity</h3>
                    <div id="recentActivity">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Details Modal -->
    <div id="applicationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalContent">
                <!-- Application details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let allApplications = [];
        let filteredApplications = [];

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        function loadData() {
            // Simulate API call to load registrations
            fetch('/api/registrations')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        allApplications = data.registrations;
                        filteredApplications = [...allApplications];
                        displayStatistics(data.statistics);
                        displayApplications();
                        displayRecentActivity();
                    }
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    // Load sample data for demonstration
                    loadSampleData();
                });
        }

        function loadSampleData() {
            const sampleData = {
                registrations: [
                    {
                        application_id: 'FRA20241001ABC12345',
                        submission_date: new Date().toISOString(),
                        status: 'submitted',
                        personal_details: {
                            applicant_name: 'Ravi Kumar',
                            tribe: 'Gond',
                            family_members: 5,
                            address: { village: 'Karanjia', district: 'Balaghat', state: 'Madhya Pradesh' }
                        },
                        land_details: {
                            claim_type: 'Individual Forest Rights',
                            land_area: 2.5,
                            occupation_since: 1995
                        },
                        prediction: { probability: 0.74, percentage: '74.0%', assessment: 'High' }
                    },
                    {
                        application_id: 'FRA20241001DEF67890',
                        submission_date: new Date(Date.now() - 86400000).toISOString(),
                        status: 'under_review',
                        personal_details: {
                            applicant_name: 'Sunita Devi',
                            tribe: 'Baiga',
                            family_members: 7,
                            address: { village: 'Mandla', district: 'Mandla', state: 'Madhya Pradesh' }
                        },
                        land_details: {
                            claim_type: 'Community Forest Rights',
                            land_area: 3.2,
                            occupation_since: 1992
                        },
                        prediction: { probability: 0.68, percentage: '68.0%', assessment: 'Medium' }
                    }
                ],
                statistics: {
                    total_applications: 2,
                    submitted: 1,
                    under_review: 1,
                    approved: 0,
                    rejected: 0,
                    total_land_area: 5.7,
                    total_families: 12
                }
            };

            allApplications = sampleData.registrations;
            filteredApplications = [...allApplications];
            displayStatistics(sampleData.statistics);
            displayApplications();
            displayRecentActivity();
        }

        function displayStatistics(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total_applications}</div>
                    <div class="stat-label">Total Applications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.submitted}</div>
                    <div class="stat-label">Pending Review</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.approved}</div>
                    <div class="stat-label">Approved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.total_land_area.toFixed(1)}</div>
                    <div class="stat-label">Total Land (Ha)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.total_families}</div>
                    <div class="stat-label">Families Benefited</div>
                </div>
            `;
        }

        function displayApplications() {
            const applicationsList = document.getElementById('applicationsList');
            
            if (filteredApplications.length === 0) {
                applicationsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No applications found</div>';
                return;
            }

            applicationsList.innerHTML = filteredApplications.map(app => `
                <div class="application-item" onclick="showApplicationDetails('${app.application_id}')">
                    <div class="app-header">
                        <div class="app-id">${app.application_id}</div>
                        <div class="app-status status-${app.status.replace('_', '-')}">${app.status.replace('_', ' ')}</div>
                    </div>
                    <div class="app-details">
                        <div><strong>Name:</strong> ${app.personal_details.applicant_name}</div>
                        <div><strong>Tribe:</strong> ${app.personal_details.tribe}</div>
                        <div><strong>Village:</strong> ${app.personal_details.address.village}</div>
                        <div><strong>Land Area:</strong> ${app.land_details.land_area} Ha</div>
                        <div><strong>Prediction:</strong> ${app.prediction ? app.prediction.percentage : 'N/A'}</div>
                        <div><strong>Submitted:</strong> ${new Date(app.submission_date).toLocaleDateString('en-IN')}</div>
                    </div>
                    <div class="action-buttons">
                        <button onclick="event.stopPropagation(); updateStatus('${app.application_id}', 'under_review')" class="btn btn-warning">üìã Review</button>
                        <button onclick="event.stopPropagation(); updateStatus('${app.application_id}', 'approved')" class="btn btn-success">‚úÖ Approve</button>
                        <button onclick="event.stopPropagation(); updateStatus('${app.application_id}', 'rejected')" class="btn btn-danger">‚ùå Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function displayRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            const activities = [
                'New application submitted by Ravi Kumar',
                'Application FRA20241001DEF67890 moved to review',
                'Field verification scheduled for Mandla village',
                'Gram Sabha meeting conducted for community claims'
            ];

            recentActivity.innerHTML = activities.map((activity, index) => `
                <div class="activity-item">
                    <div>${activity}</div>
                    <div class="activity-time">${index + 1} hour${index === 0 ? '' : 's'} ago</div>
                </div>
            `).join('');
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;

            filteredApplications = allApplications.filter(app => {
                const matchesSearch = !searchTerm || 
                    app.application_id.toLowerCase().includes(searchTerm) ||
                    app.personal_details.applicant_name.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || app.status === statusFilter;
                
                const matchesDate = !dateFilter || 
                    new Date(app.submission_date).toDateString() === new Date(dateFilter).toDateString();

                return matchesSearch && matchesStatus && matchesDate;
            });

            displayApplications();
        }

        function updateStatus(applicationId, newStatus) {
            // Simulate API call to update status
            const appIndex = allApplications.findIndex(app => app.application_id === applicationId);
            if (appIndex !== -1) {
                allApplications[appIndex].status = newStatus;
                applyFilters(); // Refresh display
                
                // Show success message
                alert(`Application ${applicationId} status updated to: ${newStatus.replace('_', ' ').toUpperCase()}`);
            }
        }

        function showApplicationDetails(applicationId) {
            const app = allApplications.find(a => a.application_id === applicationId);
            if (!app) return;

            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <h2>üìã Application Details</h2>
                <div style="margin: 20px 0;">
                    <h3>Personal Information</h3>
                    <p><strong>Name:</strong> ${app.personal_details.applicant_name}</p>
                    <p><strong>Tribe:</strong> ${app.personal_details.tribe}</p>
                    <p><strong>Family Members:</strong> ${app.personal_details.family_members}</p>
                    <p><strong>Address:</strong> ${app.personal_details.address.village}, ${app.personal_details.address.district}, ${app.personal_details.address.state}</p>
                </div>
                <div style="margin: 20px 0;">
                    <h3>Land Details</h3>
                    <p><strong>Claim Type:</strong> ${app.land_details.claim_type}</p>
                    <p><strong>Land Area:</strong> ${app.land_details.land_area} hectares</p>
                    <p><strong>Occupation Since:</strong> ${app.land_details.occupation_since}</p>
                </div>
                ${app.prediction ? `
                    <div style="margin: 20px 0; padding: 15px; background: #f0f8f0; border-radius: 8px;">
                        <h3>AI Prediction</h3>
                        <p><strong>Approval Probability:</strong> ${app.prediction.percentage}</p>
                        <p><strong>Assessment:</strong> ${app.prediction.assessment}</p>
                        <p><strong>Recommendation:</strong> ${app.prediction.recommendation || 'Complete documentation recommended'}</p>
                    </div>
                ` : ''}
                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="updateStatus('${app.application_id}', 'approved')" class="btn btn-success">‚úÖ Approve</button>
                    <button onclick="updateStatus('${app.application_id}', 'rejected')" class="btn btn-danger">‚ùå Reject</button>
                    <button onclick="closeModal()" class="btn btn-secondary">Close</button>
                </div>
            `;

            document.getElementById('applicationModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('applicationModal').style.display = 'none';
        }

        function refreshData() {
            loadData();
        }

        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Application ID,Name,Tribe,Village,District,State,Claim Type,Land Area,Status,Submission Date\n" +
                allApplications.map(app => 
                    `${app.application_id},${app.personal_details.applicant_name},${app.personal_details.tribe},${app.personal_details.address.village},${app.personal_details.address.district},${app.personal_details.address.state},${app.land_details.claim_type},${app.land_details.land_area},${app.status},${new Date(app.submission_date).toLocaleDateString()}`
                ).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "fra_applications.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generateReport() {
            alert('Generating comprehensive report... This feature will download a detailed PDF report.');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('applicationModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Real-time search
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('dateFilter').addEventListener('change', applyFilters);
    </script>
</body>
</html>